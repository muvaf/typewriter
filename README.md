# Typewriter

Typewriter is a framework for building code generation tools to produce Go code.

## Quick Start

You can see how a simple code-generation code flow works by using built-in `Producer`
generator. You'll find the following struct in `examples/producer/app`:

```go
type User struct {
	Name       string
	Id         int
	Belongings []Belonging
	UserGroup  string
}

type Belonging struct {
	Cars []string
}
```

What we want to do is to use this `User` to produce another object whose type
is defined in another package, let's say SDK of another system. Here is how it
looks like from `examples/producer/sdk`:

```go
type SDKUser struct {
	Name       string
	Id         int
	Belongings []SDKBelonging
}

type SDKBelonging struct {
	Cars []string
}
```

You can see that `sdk.SDKUser` is a subset of `app.User` and there likely are
differences in attached methods as well. What we want to do is to write a function
that will produce an `sdk.SDKUser` object with the information in `app.User`.

We will mark `User` by adding the following comment so that typewriter can know
which type to convert it to:
```
// +typewriter:types:aggregated=github.com/muvaf/typewriter/examples/producer/sdk.SDKUser
```

> Typewriter uses standard package loading mechanisms that Go build tooling uses
> in the folder it's run. The package here can be either local URL or a remote one.

Let's run the following function:
```bash
go run cmd/main.go --package-path examples/producer/app --target-package-path examples/producer
```

You'll see the result in `examples/producer/producers.go`:
```go
// Code generated by typewriter. DO NOT EDIT.

package producer

import (
	app "github.com/muvaf/typewriter/examples/producer/app"
	sdk "github.com/muvaf/typewriter/examples/producer/sdk"
)

// GenerateSDKUser returns a new sdk.SDKUser with the information from
// given app.User.
func GenerateSDKUser(a app.User) sdk.SDKUser {
	b := sdk.SDKUser{}
	b.Name = a.Name
	b.Id = a.Id
	if len(a.Belongings) != 0 {
		b.Belongings = make([]sdk.SDKBelonging, len(a.Belongings))
		for v0 := range a.Belongings {
			if len(a.Belongings[v0].Cars) != 0 {
				b.Belongings[v0].Cars = make([]string, len(a.Belongings[v0].Cars))
				for v1 := range a.Belongings[v0].Cars {
					b.Belongings[v0].Cars[v1] = a.Belongings[v0].Cars[v1]
				}
			}
		}
	}
	return b
}
```

You can take a look at `cmd/main.go` to see how `cmd.File` is used to generate a
file. It accepts a list of `NewGeneratorFn`s and `cmd.NewProducer` is a built-in
generator that we just tested. Go ahead and take a look at its [implementation](pkg/cmd/builtin.go)
and use it as reference for your own generator implementations.

## Code Generator Types

### Function Generation

`Producer` is a function generator that generates functions that can produce an
object whose type is `B` from an input object whose type is `A` by recursively
traversing all fields and structs, matching the fields and writing assignment
statements.

### Type Generation

Section to be filled.
